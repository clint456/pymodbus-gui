# Modbus Poll & Slave 管理工具 v2.0

专业的 Modbus RTU/TCP 客户端和服务器管理软件，支持 Poll 和 Slave 双模式，全新架构，完整中文界面。

## 🎯 核心特性

### 1. Modbus Poll 客户端
- ✅ **Modbus RTU** - 串口通信，支持完整的串口配置
- ✅ **Modbus TCP** - 网络通信，支持 IP 和端口配置
- ✅ **多设备并发** - 支持同时管理多个 RTU 和 TCP 设备
- ✅ **Excel 配置** - 批量导入/导出设备配置

### 2. Modbus Slave 服务器
- ✅ **RTU Slave** - 串口 Slave 服务器
- ✅ **TCP Slave** - TCP Slave 服务器
- ✅ **多 Slave 并发** - 支持同时运行多个 Slave
- ✅ **点表管理** - Excel 导入/导出寄存器点表
- ✅ **实时监控** - 寄存器值实时显示和编辑
- ✅ **灵活配置** - 支持四种寄存器类型和自定义点表

### 3. 完整功能码支持
| 功能码 | 功能描述 | 说明 |
|--------|---------|------|
| 01 | 读线圈 | Read Coils |
| 02 | 读离散输入 | Read Discrete Inputs |
| 03 | 读保持寄存器 | Read Holding Registers |
| 04 | 读输入寄存器 | Read Input Registers |
| 05 | 写单个线圈 | Write Single Coil |
| 06 | 写单个寄存器 | Write Single Register |
| 15 | 写多个线圈 | Write Multiple Coils |
| 16 | 写多个寄存器 | Write Multiple Registers |

### 4. Excel 配置管理
- 📥 **导入配置** - 从 Excel 批量导入设备配置和点表
- 📤 **导出配置** - 将设备配置和点表导出为 Excel 文件
- 📝 **配置模板** - 自动生成标准配置模板和点表模板
- 📊 **日志导出** - 导出操作日志到 Excel

### 5. 完整中文界面
- 所有界面元素均为中文
- 完整的中文注释
- 友好的错误提示

### 6. 操作日志
- 实时记录所有操作
- 带颜色区分的日志级别
- 支持导出日志

## 🚀 快速开始

### 安装依赖

```bash
cd pymodbus-gui
poetry install
```

### 运行程序

```bash
poetry run python src/pymodbus_gui/run.py
```

或使用快捷方式：

```bash
Push-Location "D:\BaiduSyncdisk\work\project\hy.edgeAgent\Hy-Jr-Software\pymodbus-gui-main\pymodbus-gui"; poetry run python src/pymodbus_gui/run.py; Pop-Location
```

## 📖 使用指南

### 1. 添加设备

#### 方式一：手动添加
1. 点击"设备管理"选项卡
2. 点击"添加设备"按钮
3. 填写设备配置：
   - **设备ID**: 唯一标识（如 RTU_001）
   - **设备名称**: 描述性名称
   - **连接类型**: 选择 RTU 或 TCP
   - **从站地址**: Modbus 从站地址（1-247）
   - **超时时间**: 连接超时（秒）

#### RTU 配置
- **串口端口**: 选择可用串口（可刷新）
- **波特率**: 9600/19200/38400/57600/115200
- **数据位**: 7/8
- **校验位**: N(无)/E(偶)/O(奇)
- **停止位**: 1/2

#### TCP 配置
- **IP地址**: 设备 IP 地址
- **TCP端口**: Modbus TCP 端口（默认 502）

4. 点击"测试连接"验证配置
5. 点击"确定"保存设备

#### 方式二：Excel 批量导入
1. 点击菜单"文件" -> "创建配置模板"
2. 在 Excel 中编辑设备配置
3. 点击"文件" -> "导入设备配置"
4. 选择编辑好的 Excel 文件

### 2. 连接设备

1. 在设备列表中选择设备
2. 点击"连接"按钮
3. 查看状态栏的连接结果
4. 设备状态图标变为绿色表示连接成功

### 3. 执行 Modbus 操作

1. 切换到"设备操作"选项卡
2. 选择已连接的设备
3. 选择功能码
4. 输入起始地址
5. 根据功能码输入相应参数：
   - **读操作**: 输入读取数量
   - **写单个**: 输入单个值
   - **写多个**: 输入逗号分隔的值列表
6. 点击"执行操作"
7. 查看结果表格

### 4. 查看日志

切换到"操作日志"选项卡，查看所有操作记录：
- 🔵 **INFO** - 常规信息
- 🟠 **WARNING** - 警告信息
- 🔴 **ERROR** - 错误信息
- 🟢 **SUCCESS** - 成功操作

### 5. 导出配置

点击菜单"文件" -> "导出设备配置"，将当前所有设备配置保存为 Excel 文件。

## 📁 项目结构

```
pymodbus-gui/
├── src/
│   └── pymodbus_gui/
│       ├── core/                 # 核心功能模块
│       │   ├── device_manager.py # 设备管理器
│       │   └── excel_manager.py  # Excel 管理器
│       ├── ui/                   # 界面模块
│       │   ├── main_window.py    # 主窗口
│       │   ├── device_list_widget.py    # 设备列表
│       │   ├── add_device_dialog.py     # 添加设备对话框
│       │   ├── operation_widget.py      # 操作面板
│       │   └── log_widget.py     # 日志组件
│       └── run.py                # 程序入口
├── pyproject.toml                # 项目配置
└── README.md                     # 说明文档
```

## 🔧 核心技术

- **PyQt6** - 现代化的 GUI 框架
- **pymodbus** - 强大的 Modbus 协议库
- **openpyxl** - Excel 文件处理
- **pandas** - 数据处理
- **threading** - 多线程支持

## 💡 使用示例

### Excel 配置模板格式

| 设备ID | 设备名称 | 连接类型 | 从站地址 | 串口端口 | 波特率 | 数据位 | 校验位 | 停止位 | IP地址 | TCP端口 | 超时时间(秒) |
|--------|---------|---------|---------|----------|--------|--------|--------|--------|--------|---------|-------------|
| RTU_001 | RTU测试设备 | RTU | 1 | COM3 | 9600 | 8 | N | 1 | | | 3.0 |
| TCP_001 | TCP测试设备 | TCP | 1 | | | | | | 192.168.1.100 | 502 | 3.0 |

### 功能码操作示例

#### 读取保持寄存器（功能码 03）
```
设备: RTU_001
功能码: 03 - 读保持寄存器
起始地址: 0
读取数量: 10
```

#### 写多个寄存器（功能码 16）
```
设备: TCP_001
功能码: 16 - 写多个寄存器
起始地址: 100
写入值: 1000,2000,3000,4000,5000
```

#### 写单个线圈（功能码 05）
```
设备: RTU_001
功能码: 05 - 写单个线圈
起始地址: 0
写入值: True
```

## 🔍 故障排除

### RTU 设备无法连接
1. 检查串口是否被其他程序占用
2. 确认串口参数与设备匹配
3. 检查物理连接（线缆、接口）
4. 验证从站地址是否正确

### TCP 设备无法连接
1. 使用 ping 命令测试网络连通性
2. 确认 IP 地址和端口正确
3. 检查防火墙设置
4. 确认 Modbus TCP 服务正在运行

### 读写操作失败
1. 确认设备已成功连接
2. 检查地址范围是否在设备支持范围内
3. 验证数据类型和值范围
4. 查看操作日志中的详细错误信息

## 📝 版本历史

### v2.0 (2025-12-26)
- ✨ 全新架构重写
- ✨ 完整中文界面
- ✨ 支持 RTU 和 TCP 双协议
- ✨ 支持功能码 1-21
- ✨ 多设备并发管理
- ✨ Excel 配置导入/导出
- ✨ 操作日志记录
- ✨ 现代化界面设计

## 📄 许可证

MIT License

## 👥 贡献

欢迎提交 Issue 和 Pull Request！

## 📧 联系方式

如有问题或建议，请通过 Issue 反馈。

---

**Enjoy Modbus! 🎉**
